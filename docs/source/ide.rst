IDE и симулятор
===============

В данном разделе описана настольная IDE, входящая в поставку прошивки.
Инструмент предназначен для проверки траекторий без аппаратуры и
использует те же модули планировщика, TinyML-оптимизатора и визуализатора,
что и основная система.

Формат проекта
--------------

Файлы проектов имеют расширение ``.cncp`` и состоят из простых директив::

   NAME Demo Workspace
   TYPE BSPLINE3
   PERIOD_MS 1.0
   LIMITS 180.0 950.0 4000.0
   TINYML_PROFILE profile.ini
   ST_PROGRAM project.st
   WAYPOINT 0.0 0.0 -20.0

Каждая директива соответствует полям структуры :c:type:`ide_project`. Все
значения автоматически конвертируются в фиксированную точку Q16.16.

Генерация плана
---------------

При загрузке проекта вызывается :c:func:`ide_project_generate`, которая
выполняет следующие шаги:

#. Построение сплайна по контрольным точкам с помощью
   :c:func:`spl_make_from_waypoints`.
#. Загрузка профиля TinyML (директива ``TINYML_PROFILE``) через
   :c:func:`tinyml_profile_load` и применение коэффициентов к сети
   :c:func:`tinyml_profile_apply`.
#. Применение TinyML-оптимизатора для корректировки ограничений
   скорости/ускорения в зависимости от кривизны.
#. Временная параметризация методом Шина–Маккея через
   :c:func:`spl_time_scale`.
#. Компиляция программы IEC 61131-3 Structured Text, указанной в директиве
   ``ST_PROGRAM``, функцией :c:func:`stc_compile_file` и сохранение
   подсветки синтаксиса.

Экспорт артефактов
------------------

Команда ``cnc_ide <project.cncp> <output_dir>`` создаёт следующий набор
файлов:

* ``*_ui.ppm`` – изображение конфигуратора.
* ``*_ui.json`` – экспорт настроек.
* ``*_traj.obj`` – 3D-модель траектории.
* ``*_traj.ppm`` – рендер траектории.
* ``*_report.txt`` – сводная информация о длительности и ограничениях.
* ``*_st.c`` и ``*_st_metadata.json`` – результат компиляции Structured Text и
  метаданные для IDE (подсветка, автодополнение).
* ``*_debug.csv`` – CSV-трасса с координатами, скоростями и углами суставов,
  рассчитанными :c:func:`delta_inverse_kinematics`.

Полученные данные можно загружать в внешний вьювер или использовать в
офлайн-демонстрациях. Все функции доступны и из тестов хоста, что
позволяет автоматически проверять целостность IDE при CI-сборке.
